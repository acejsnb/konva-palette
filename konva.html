<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>konva-3.4.1</title>
    <style>
        .box {
            background-color: #333;
        }
        button.active {
            color: #f00;
        }
    </style>
</head>
<body>
<div class="box">
    <div class="tools">
        <button class="pencil">铅笔</button>
        <button>圆-空心</button>
        <button>矩形</button>
        <button>矩形-空心</button>
        <button onclick="removeFn();">删除</button>
    </div>

    <div id="container"></div>
</div>

<script src="konva.js"></script>
<script>
    // 1 create stage
    const stage=new Konva.Stage({
        container: 'container',
        width: 1200,
        height: 800
    });

    // 2 create layer
    const layer=new Konva.Layer();
    stage.add(layer);

    // 3 create our shape
    const ellipse=new Konva.Ellipse({
        x: 200,
        y: 200,
        radiusX: 100,
        radiusY: 70,
        name: 'ellipse',
        stroke: 'red',
        strokeWidth: 4,
        draggable: true
    });
    // 4. add the shape to the layer
    layer.add(ellipse);

    const circle2=new Konva.Circle({
        x: 300,
        y: 250,
        radius: 80,
        fill: 'green',
        name: 'circle',
        stroke: 'black',
        draggable: true,
        dragBoundFunc: function (pos) {
            console.log(pos);
            let x=0, y=0;
            if (pos.x<(1200-80) || pos.x>80 ) {
                x=pos.x;
            }
            if (pos.x>=1200-80) {
                x=1200-80;
            }
            if (pos.x<=80) {
                x=80;
            }
            if (pos.y<(800-80) || pos.y>80 ) {
                y=pos.y;
            }
            if (pos.y>=800-80) {
                y=800-80;
            }
            if (pos.y<=80) {
                y=80;
            }
            return {
                x: x,
                y: y
            };
        }
    });
    layer.add(circle2);

    // draw the image
    layer.draw();

    // 移除改变大小事件
    stage.on('mousedown', function(e) {
        // 如果点击空白处 移除图形选择框
        console.log(e);
        if (e.target === stage) {
            // 移除图形选择框
            stage.find('Transformer').destroy();
            layer.draw();
            return;
        }
        // do nothing if clicked NOT on our rectangles
        if (!e.target.hasName('ellipse') && !e.target.hasName('circle')) {
            return;
        }
        // 移除图形选择框
        stage.find('Transformer').destroy();

        // 创建图形选框事件
        const tr = new Konva.Transformer();
        layer.add(tr);
        tr.attachTo(e.target);
        layer.draw();
    });

    // 移除图形
    function removeFn() {
        // circle1.setAttrs({
        //     x: 200,
        //     y: 150
        // });
        circle2.remove();
        layer.draw();
    }
</script>
</body>
</html>